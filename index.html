<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>AIAA 5028 Attendence</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    form {
      width: 500px;
      margin: 0 auto;
    }
    @media (max-width: 600px){
      form {
        width: 80%
      }
  </style>
</head>
<body>
  <p>Hello AIAA 5028 Students. <br>
    On Dec.8 We will have our last class, and you will get <span style="color: red">a cup of Starbucks!</span><br>
    We encourage everyone to come to celebrate the end of <span style="color: blue">first ever AIAA 5028 course in history!</span><br>
    <strong>If you will come in person, please fill in your name below and submit to us.<strong><br>
  </p>
  <form id="name-form" style="width: 500px; height: 300px; background-color: lightblue;">
    <label for="name-input">Enter your name:</label>
    <input id="name-input" type="text" />
    <button type="submit">Submit</button>
  </form>
  <p id="response"></p>
  <script>
    // Get the name form
    let nameForm = document.querySelector('#name-form');
    let responseSubmit = document.querySelector('#response');

    // Set up the submit event handler for the name form
    nameForm.addEventListener('submit', function(event) {
      // Prevent the form from being submitted
      event.preventDefault();
      responseSubmit.textContent = "Submitting...wait for a second..."
      // Get the name input
      let nameInput = document.querySelector('#name-input');
      let token = atob('Z2hwX0l3Rk45a09PcFJvcHJXRE9JdlN1bEtIcVdKMUpXVzEwQ0s5aw==')

      // Get the current contents of the names file
      fetch('https://api.github.com/repos/stellaludai/stellaludai.github.io/contents/names.txt')
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            console.error('Failed to get file contents from repository');
          }
        })
        .then(file => {
          // Append the user's name to the contents of the file
          let newContents = atob(file.content) + '\n' + nameInput.value;
          console.log(newContents)
          // Set up the request parameters
          let params = {
            message: 'Appending name to names.txt file', // The commit message
            content: btoa(newContents), // The updated file contents, encoded as base64
            sha: file.sha // The SHA of the current file version
          };

          // Send a request to the GitHub API to update the file
          fetch('https://api.github.com/repos/stellaludai/stellaludai.github.io/contents/names.txt', {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
             },
            body: JSON.stringify(params)
          })
            .then(response => {
              if (response.ok) {
                console.log('File was successfully updated in repository');
                responseSubmit.textContent = `${nameInput.value} Thank you for your participation!`
              } else {
                console.error('Failed to update file in repository');
              }
            })
            .catch(error => {
              console.error(error);
            });
        });
    });
  </script>
